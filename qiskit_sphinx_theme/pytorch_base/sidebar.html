<nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
    <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <div class="sidebar">
    <div class="pytorch-left-menu-search">
        {% include "searchbox.html" %}
    </div>

    <!-- render sidebar from the toctree -->
    {% set global_toc = toctree(maxdepth=1,
                                collapse=theme_collapse_navigation|tobool,
                                includehidden=theme_includehidden|tobool) %}
    {% if global_toc %}
        {{ global_toc }}
    {% endif %}

    <!-- PREVIOUS RELEASES -->
        {% if version_list %}
            <div class="sidebar-l1-expandable">Previous Releases</div>
            <div class="sidebar-subheadings">
                {% for version in version_list | sort(reverse=True) %}
                    <div class="sidebar-l2"><a href="#" onclick="redirectToVersion( {{ version }} )">{{ version }}</a></div>
                {% endfor %}
            </div>
        {% endif %}

    </div>
  </div>
</nav>

<!-- PREVIOUS RELEASES URL -->
{% if version_list %}
<script>
    const _ECOSYSTEM_PROJECTS = [
        "aer",
        "experiments",
        "finance",
        "machine-learning",
        "nature",
        "optimization",
        "rustworkx",
    ];

    const _determineVersionURL = (currentURL, version) => {
        const ecosystemMatch = currentURL.match(/(?:.*)(\/ecosystem\/\w+)(?:\/|$)/);

        // With `/documentation/...` URLs, we need to detect whether the folder after `/documentation`
        // is a top-level Ecosystem project (e.g. /documentation/nature) vs. a sub-folder
        // of the Terra docs (e.g. /documentation/apidocs/foo.html).
        //
        // So, we hardcode the specific ecosystem projects that were using the legacy scheme.
        // Everything else is assumed to be a Terra sub-folder.
        const projectsPattern = _ECOSYSTEM_PROJECTS.join("|");
        const legacyEcosystemMatch = currentURL.match(
            new RegExp(`(?:.*)(\\/documentation\\/(${projectsPattern}))(?:\\/|$)`)
        );
        const terraMatch = currentURL.match(/(?:.*)(\/documentation)(?:\/|$)/);
        const match = ecosystemMatch || legacyEcosystemMatch || terraMatch;
        if (!match) {
            return null;
        }
        return `${match[1]}/stable/${version}/index.html`;
    };

    const redirectToVersion = (version) => {
        const result = _determineVersionURL(window.location.href, version);
        if (result) {
            window.location.href = result;
        }
    }
</script>
{% endif %}

<!-- OPTIONAL EXPANDABLE FUNCTIONALITY -->
{% if expandable_sidebar %}
<script>
    var expandable_rows = document.getElementsByClassName("caption");
    var i;
    var j;
    for (i = 0; i < expandable_rows.length; i++) {
        // add the chevron icon
        expandable_rows[i].classList.add("expandable")
        // expand the dropdown if user is currently on a page included in the dropdown
        var subheadings = expandable_rows[i].nextElementSibling
        if (subheadings.classList.contains("current")) {
            subheadings.style.display = "block"
            subheadings.style.marginLeft = "0.5rem";
            expandable_rows[i].classList.add("open");
        } else {subheadings.style.display = "none"}

        // expand and unexpand dropdown when clicked
        expandable_rows[i].addEventListener("click", function() {
            this.classList.toggle("open");
            var clicked_subheadings = this.nextElementSibling;
            if (clicked_subheadings.style.display === "block") {
            clicked_subheadings.style.display = "none";
            } else {
            clicked_subheadings.style.display = "block";
            }
        });

    }
</script>
{% endif %}

<!-- STYLING -->
<script>
    // indent subheadings under captions
    expandable_rows = document.getElementsByClassName("caption");
    var i;
    for (i = 0; i < expandable_rows.length; i++) {
        expandable_rows[i].nextElementSibling.style.marginLeft = "1rem"

        // un-bold subheadings in dropdown
        var subheadings = expandable_rows[i].nextElementSibling
        for (j = 0; j < subheadings.children.length; j++) {
            subheadings.children[j].style.fontWeight = "unset"
        }
    }

    // adjust toctree class name to style external links
    var toc_rows = document.getElementsByClassName("toctree-l1");
    var i;
    for (i = 0; i < toc_rows.length; i++) {
        if (toc_rows[i].children[0].className === "reference external") {
            toc_rows[i].className = "toctree-l1-external"
            }
    }

    // expand and unexpand previous releases dropdown when clicked
    var release_rows = document.getElementsByClassName("sidebar-l1-expandable");
    for (i = 0; i < expandable_rows.length; i++) {
        release_rows[i].addEventListener("click", function() {
            this.classList.toggle("open");
            var clicked_subheadings = this.nextElementSibling;
            if (clicked_subheadings.style.display === "block") {
            clicked_subheadings.style.display = "none";
            } else {
            clicked_subheadings.style.display = "block";
            }
        });
    }
</script>